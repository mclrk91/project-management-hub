<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Management Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        .mobile-menu-open { transform: translateX(0); }
        .mobile-menu-closed { transform: translateX(-100%); }
        
        /* Desktop sidebar should always be visible */
        @media (min-width: 1024px) {
            .lg\:mobile-menu-open { transform: translateX(0) !important; }
        }
        
        /* Beautiful gradients */
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-card { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .gradient-success { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .gradient-warning { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .gradient-purple { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        
        /* Enhanced shadows */
        .shadow-beautiful { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .shadow-card { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .shadow-hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        
        /* Smooth animations */
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        .animate-bounce-subtle { animation: bounceSubtle 0.6s ease-in-out; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes bounceSubtle {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-3px); }
            60% { transform: translateY(-2px); }
        }
        
        /* Beautiful hover effects */
        .hover-lift { transition: all 0.3s ease; }
        .hover-lift:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); }
        
        /* Glass morphism effect */
        .glass { background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.18); }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        
        /* Enhanced focus states */
        .focus-beautiful:focus { outline: none; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); border-color: #6366f1; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 min-h-screen">
    <!-- Mobile menu overlay -->
    <div id="mobile-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden"></div>
    
    <!-- Sidebar -->
    <div id="sidebar" class="fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-beautiful sidebar-transition mobile-menu-closed lg:mobile-menu-open">
        <div class="gradient-bg flex items-center justify-between h-16 px-6">
            <h1 class="text-xl font-bold text-white animate-bounce-subtle">✨ Project Hub</h1>
            <button id="close-sidebar" class="lg:hidden p-2 rounded-md hover:bg-white hover:bg-opacity-20 text-white transition-all duration-200">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>
        
        <nav class="mt-6 px-3">
            <div class="space-y-2">
                <a href="#" onclick="showSection('dashboard')" class="nav-link flex items-center px-4 py-3 text-sm font-medium rounded-xl text-white gradient-bg shadow-card hover-lift">
                    <i data-lucide="home" class="w-5 h-5 mr-3"></i>
                    Overview
                </a>
                <a href="#" onclick="showSection('kanban')" class="nav-link flex items-center px-4 py-3 text-sm font-medium rounded-xl text-gray-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 hover:text-indigo-700 transition-all duration-200 hover-lift">
                    <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>
                    Kanban Board
                </a>
                <a href="#" onclick="showSection('vendors')" class="nav-link flex items-center px-4 py-3 text-sm font-medium rounded-xl text-gray-700 hover:bg-gradient-to-r hover:from-green-50 hover:to-emerald-50 hover:text-green-700 transition-all duration-200 hover-lift">
                    <i data-lucide="users" class="w-5 h-5 mr-3"></i>
                    Vendors
                </a>
                <a href="#" onclick="showSection('ai-assistant')" class="nav-link flex items-center px-4 py-3 text-sm font-medium rounded-xl text-gray-700 hover:bg-gradient-to-r hover:from-purple-50 hover:to-pink-50 hover:text-purple-700 transition-all duration-200 hover-lift">
                    <i data-lucide="bot" class="w-5 h-5 mr-3"></i>
                    AI Assistant
                </a>
            </div>
            
            <div class="mt-8">
                <h3 class="px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">🚀 Projects</h3>
                <div id="project-list" class="space-y-1">
                    <!-- Projects will be loaded here -->
                </div>
            </div>
        </nav>
    </div>

    <!-- Main content -->
    <div class="lg:pl-64">
        <!-- Top bar -->
        <div class="sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 bg-white border-b border-gray-200 px-4 shadow-beautiful sm:gap-x-6 sm:px-6 lg:px-8">
            <button id="open-sidebar" class="lg:hidden p-2 rounded-xl hover:bg-gray-100 transition-all duration-200">
                <i data-lucide="menu" class="w-5 h-5 text-gray-700"></i>
            </button>
            
            <div class="flex flex-1 gap-x-4 self-stretch lg:gap-x-6">
                <div class="relative flex flex-1">
                    <input type="text" id="search-input" placeholder="Search projects and tasks..." 
                           class="block w-full rounded-xl border-0 py-3 pl-12 pr-4 text-gray-900 bg-white shadow-card placeholder:text-gray-500 focus-beautiful sm:text-sm transition-all duration-200">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3">
                        <i data-lucide="search" class="w-4 h-4 text-gray-400"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page content -->
        <main class="py-8 animate-fade-in">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="section px-4 sm:px-6 lg:px-8">
                <div class="sm:flex sm:items-center sm:justify-between mb-8">
                    <div class="animate-slide-up">
                        <h1 class="text-4xl font-bold leading-7 bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent sm:truncate sm:text-5xl sm:tracking-tight">Dashboard</h1>
                    </div>
                    <div class="mt-6 sm:ml-16 sm:mt-0 sm:flex-none animate-slide-up">
                        <button onclick="showNewProjectForm()" class="group relative overflow-hidden rounded-2xl gradient-bg px-6 py-3 text-center text-sm font-semibold text-white shadow-beautiful hover-lift transition-all duration-300">
                            <div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                            <i data-lucide="plus" class="w-5 h-5 inline mr-2"></i>
                            New Project
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-8 lg:grid-cols-3">
                    <!-- Urgent Tasks -->
                    <div class="group bg-white bg-opacity-80 backdrop-blur-sm overflow-hidden shadow-beautiful rounded-2xl hover-lift transition-all duration-300 border border-white border-opacity-50">
                        <div class="p-8">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 p-3 rounded-2xl bg-gradient-to-r from-red-400 to-pink-500 shadow-card">
                                    <i data-lucide="alert-triangle" class="w-6 h-6 text-white"></i>
                                </div>
                                <div class="ml-6 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-semibold text-gray-500 uppercase tracking-wider">⚡ Urgent Tasks (48h)</dt>
                                        <dd class="text-xl font-bold text-gray-900 mt-1">Tasks due within the next 48 hours</dd>
                                    </dl>
                                </div>
                            </div>
                            <div class="mt-6" id="urgent-tasks">
                                <!-- Urgent tasks will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Recent Projects -->
                    <div class="group bg-white bg-opacity-80 backdrop-blur-sm overflow-hidden shadow-beautiful rounded-2xl hover-lift transition-all duration-300 border border-white border-opacity-50">
                        <div class="p-8">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 p-3 rounded-2xl bg-gradient-to-r from-blue-400 to-indigo-500 shadow-card">
                                    <i data-lucide="folder" class="w-6 h-6 text-white"></i>
                                </div>
                                <div class="ml-6 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-semibold text-gray-500 uppercase tracking-wider">📁 Recent Projects</dt>
                                        <dd class="text-lg font-medium text-gray-900">Your most recently updated projects</dd>
                                    </dl>
                                </div>
                            </div>
                            <div class="mt-4" id="recent-projects">
                                <!-- Recent projects will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Calendar Widget -->
                    <div class="group bg-white bg-opacity-80 backdrop-blur-sm overflow-hidden shadow-beautiful rounded-2xl hover-lift transition-all duration-300 border border-white border-opacity-50">
                        <div class="p-8">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 p-3 rounded-2xl bg-gradient-to-r from-purple-400 to-pink-500 shadow-card">
                                    <i data-lucide="calendar" class="w-6 h-6 text-white"></i>
                                </div>
                                <div class="ml-6 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-semibold text-gray-500 uppercase tracking-wider">📅 Today</dt>
                                        <dd class="text-lg font-medium text-gray-900">Current date</dd>
                                    </dl>
                                </div>
                            </div>
                            <div class="mt-6 text-center">
                                <div id="current-date" class="text-3xl font-bold text-gray-900 mb-2"></div>
                                <div id="current-day" class="text-lg font-medium text-gray-600 mb-1"></div>
                                <div id="current-month-year" class="text-sm text-gray-500"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kanban Section -->
            <div id="kanban-section" class="section hidden px-4 sm:px-6 lg:px-8 animate-fade-in">
                <div class="sm:flex sm:items-center sm:justify-between mb-8">
                    <div class="animate-slide-up">
                        <h1 class="text-4xl font-bold leading-7 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent sm:truncate sm:text-5xl sm:tracking-tight">Kanban Board</h1>
                    </div>
                    <div class="mt-6 sm:mt-0 animate-slide-up">
                        <button onclick="showNewTaskForm()" class="group relative overflow-hidden rounded-2xl gradient-success px-6 py-3 text-center text-sm font-semibold text-white shadow-beautiful hover-lift transition-all duration-300">
                            <div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                            <i data-lucide="plus" class="w-5 h-5 inline mr-2"></i>
                            New Task
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="group bg-white bg-opacity-60 backdrop-blur-sm rounded-2xl p-6 shadow-beautiful border border-white border-opacity-50 hover-lift transition-all duration-300">
                        <div class="flex items-center mb-4">
                            <div class="w-3 h-3 rounded-full bg-gradient-to-r from-gray-400 to-gray-500 mr-3"></div>
                            <h3 class="font-bold text-gray-800 text-lg">📝 To Do</h3>
                        </div>
                        <div id="todo-column" class="space-y-4 min-h-[200px]">
                            <!-- Tasks will be loaded here -->
                        </div>
                    </div>
                    <div class="group bg-white bg-opacity-60 backdrop-blur-sm rounded-2xl p-6 shadow-beautiful border border-white border-opacity-50 hover-lift transition-all duration-300">
                        <div class="flex items-center mb-4">
                            <div class="w-3 h-3 rounded-full bg-gradient-to-r from-blue-400 to-blue-500 mr-3"></div>
                            <h3 class="font-bold text-blue-800 text-lg">🚀 In Progress</h3>
                        </div>
                        <div id="in-progress-column" class="space-y-4 min-h-[200px]">
                            <!-- Tasks will be loaded here -->
                        </div>
                    </div>
                    <div class="group bg-white bg-opacity-60 backdrop-blur-sm rounded-2xl p-6 shadow-beautiful border border-white border-opacity-50 hover-lift transition-all duration-300">
                        <div class="flex items-center mb-4">
                            <div class="w-3 h-3 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 mr-3"></div>
                            <h3 class="font-bold text-orange-800 text-lg">👀 Review</h3>
                        </div>
                        <div id="review-column" class="space-y-4 min-h-[200px]">
                            <!-- Tasks will be loaded here -->
                        </div>
                    </div>
                    <div class="group bg-white bg-opacity-60 backdrop-blur-sm rounded-2xl p-6 shadow-beautiful border border-white border-opacity-50 hover-lift transition-all duration-300">
                        <div class="flex items-center mb-4">
                            <div class="w-3 h-3 rounded-full bg-gradient-to-r from-green-400 to-emerald-500 mr-3"></div>
                            <h3 class="font-bold text-green-800 text-lg">✅ Completed</h3>
                        </div>
                        <div id="completed-column" class="space-y-4 min-h-[200px]">
                            <!-- Tasks will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar Section -->
            <div id="calendar-section" class="section hidden px-4 sm:px-6 lg:px-8">
                <h1 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">Calendar</h1>
                <div class="mt-8 bg-white shadow rounded-lg p-6">
                    <p class="text-gray-500">Calendar view coming soon...</p>
                </div>
            </div>

            <!-- Vendors Section -->
            <div id="vendors-section" class="section hidden px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center mb-8">
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">Vendors</h1>
                    <button onclick="showNewVendorForm()" class="inline-flex items-center px-6 py-3 border border-transparent text-sm font-medium rounded-xl text-white bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 shadow-beautiful hover-lift transition-all duration-200">
                        <i data-lucide="plus" class="w-5 h-5 inline mr-2"></i>
                        New Vendor
                    </button>
                </div>
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3" id="vendors-list">
                    <!-- Vendors will be loaded here -->
                </div>
            </div>
            
            <!-- AI Assistant Section -->
            <div id="ai-assistant-section" class="section hidden px-4 sm:px-6 lg:px-8">
                <div class="sm:flex sm:items-center sm:justify-between mb-8">
                    <div class="animate-slide-up">
                        <h1 class="text-4xl font-bold leading-7 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent sm:truncate sm:text-5xl sm:tracking-tight">AI Assistant</h1>
                    </div>
                    <div class="mt-6 sm:ml-16 sm:mt-0 sm:flex-none animate-slide-up">
                        <button onclick="clearAIChat()" class="group relative overflow-hidden rounded-2xl bg-gray-600 px-6 py-3 text-center text-sm font-semibold text-white shadow-beautiful hover-lift transition-all duration-300">
                            <div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                            <span class="relative flex items-center">
                                <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>
                                Clear Chat
                            </span>
                        </button>
                    </div>
                </div>
                
                <!-- API Key Setup -->
                <div id="api-key-setup" class="mb-6 p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl border border-purple-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <i data-lucide="key" class="w-5 h-5 text-purple-600 mr-2"></i>
                            <h3 class="text-lg font-semibold text-purple-900">OpenAI API Key Setup</h3>
                        </div>
                        <button onclick="resetApiKey()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all duration-200 text-sm font-medium">
                            Reset Key
                        </button>
                    </div>
                    <div class="flex gap-3">
                        <input type="password" id="openai-api-key" placeholder="Enter your OpenAI API key..." 
                               class="flex-1 px-4 py-3 border border-purple-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <button onclick="saveApiKey()" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl hover:from-purple-700 hover:to-pink-700 transition-all duration-200 font-medium">
                            Save Key
                        </button>
                    </div>
                    <p class="text-sm text-purple-700 mt-2">Your API key is stored locally and never shared. Get one at <a href="https://platform.openai.com/api-keys" target="_blank" class="underline">platform.openai.com</a></p>
                </div>
                
                <!-- Chat Interface -->
                <div class="bg-white rounded-2xl shadow-card overflow-hidden">
                    <!-- Chat Messages -->
                    <div id="chat-messages" class="h-96 overflow-y-auto p-6 space-y-4 bg-gradient-to-b from-gray-50 to-white">
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0 w-8 h-8 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full flex items-center justify-center">
                                <i data-lucide="bot" class="w-4 h-4 text-white"></i>
                            </div>
                            <div class="flex-1 bg-white rounded-2xl p-4 shadow-sm">
                                <p class="text-gray-700">Hi! I'm your AI assistant. I can help you with questions about your projects, tasks, and vendors.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat Input -->
                    <div class="border-t border-gray-200 p-4">
                        <div class="flex space-x-3">
                            <input type="text" id="ai-chat-input" placeholder="Ask me anything about your projects..." 
                                   class="flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                   onkeypress="if(event.key==='Enter') sendAIMessage()">
                            <button onclick="sendAIMessage()" id="send-ai-message" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl hover:from-purple-700 hover:to-pink-700 transition-all duration-200 font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                                <i data-lucide="send" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- New Project Modal -->
    <div id="new-project-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Create New Project</h3>
                <form id="new-project-form">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Project Title</label>
                        <input type="text" id="project-title" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="project-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                        <select id="project-priority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="hideNewProjectForm()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Cancel</button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700">Create Project</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Project Modal -->
    <div id="edit-project-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Edit Project</h3>
                <form id="edit-project-form">
                    <input type="hidden" id="edit-project-id">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Project Title</label>
                        <input type="text" id="edit-project-title" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="edit-project-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                        <select id="edit-project-priority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="hideEditProjectForm()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Cancel</button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700">Update Project</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- New Task Modal -->
    <div id="new-task-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Create New Task</h3>
                <form id="new-task-form">
                    <input type="hidden" id="task-project-id">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Task Title</label>
                        <input type="text" id="task-title" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="task-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select id="task-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="todo" selected>To Do</option>
                            <option value="in_progress">In Progress</option>
                            <option value="review">Review</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                        <select id="task-priority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Due Date</label>
                        <input type="date" id="task-due-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="hideNewTaskForm()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Cancel</button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700">Create Task</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div id="edit-task-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Edit Task</h3>
                <form id="edit-task-form">
                    <input type="hidden" id="edit-task-id">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Task Title</label>
                        <input type="text" id="edit-task-title" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="edit-task-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select id="edit-task-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="todo">To Do</option>
                            <option value="in_progress">In Progress</option>
                            <option value="review">Review</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                        <select id="edit-task-priority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Due Date</label>
                        <input type="date" id="edit-task-due-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="hideEditTaskForm()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Cancel</button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700">Update Task</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- New Vendor Modal -->
    <div id="new-vendor-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Add New Vendor</h3>
                <form id="new-vendor-form">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Vendor Name</label>
                        <input type="text" id="new-vendor-name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Contact Person</label>
                        <input type="text" id="new-vendor-contact" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="new-vendor-email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                        <input type="tel" id="new-vendor-phone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Services</label>
                        <textarea id="new-vendor-services" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="hideNewVendorForm()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Cancel</button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700">Add Vendor</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Vendor Modal -->
    <div id="edit-vendor-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Edit Vendor</h3>
                <form id="edit-vendor-form">
                    <input type="hidden" id="edit-vendor-id">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Vendor Name</label>
                        <input type="text" id="edit-vendor-name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Contact Person</label>
                        <input type="text" id="edit-vendor-contact" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="edit-vendor-email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                        <input type="tel" id="edit-vendor-phone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Services</label>
                        <textarea id="edit-vendor-services" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="hideEditVendorForm()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Cancel</button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700">Update Vendor</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
        </div>
    </div>

    <script>
        // Data with localStorage persistence
        let projects = JSON.parse(localStorage.getItem('projects')) || [
            { id: 1, title: "Monthly Content", description: "Regular monthly content creation and management", status: "active", priority: "medium", tasks: 8 },
            { id: 2, title: "TM Media Insights", description: "Talent marketing media insights and analysis", status: "active", priority: "high", tasks: 1 },
            { id: 3, title: "Competitor Research", description: "Research and analysis of competitor strategies", status: "active", priority: "medium", tasks: 1 },
            { id: 4, title: "MCAP", description: "Marketing Campaign Approval Process", status: "active", priority: "high", tasks: 2 },
            { id: 5, title: "Concept Planning", description: "Q4 concept planning and strategy", status: "active", priority: "medium", tasks: 1 }
        ];

        let tasks = JSON.parse(localStorage.getItem('tasks')) || [
            { id: 1, title: "Send draft email to Jen", description: "Draft email to Jen to send to Jill", status: "todo", priority: "urgent", project_id: 1, due_date: "2025-08-11" },
            { id: 2, title: "UHC Video - Suzanne request", description: "Handle Suzanne's video request", status: "todo", priority: "urgent", project_id: 1, due_date: "2025-08-11" },
            { id: 3, title: "2025 Revised Messaging Framework", description: "Updated messaging framework for 2025", status: "review", priority: "high", project_id: 4, due_date: "2025-08-12" },
            { id: 4, title: "LinkedIn Learning Project Management", description: "Complete LinkedIn Learning course", status: "in_progress", priority: "low", project_id: 1 },
            { id: 5, title: "Q4 Concept Planning", description: "Strategic planning for Q4 concepts", status: "todo", priority: "medium", project_id: 5 }
        ];

        let vendors = JSON.parse(localStorage.getItem('vendors')) || [
            { id: 1, name: "24 Seven", contact: "Ashley Sanchez", email: "ashley@24seven.com", phone: "(555) 123-4567", services: "Creative Services, Graphic Design, Video Production" },
            { id: 2, name: "Home Agency", contact: "Sarah Johnson", email: "sarah@homeagency.com", phone: "(555) 234-5678", services: "Digital Marketing, Social Media Management, SEO" },
            { id: 3, name: "Creative Partners", contact: "Mike Chen", email: "mike@creativepartners.com", phone: "(555) 345-6789", services: "Brand Strategy, Logo Design, Marketing Campaigns" },
            { id: 4, name: "Tech Solutions", contact: "Jennifer Davis", email: "jen@techsolutions.com", phone: "(555) 456-7890", services: "Web Development, App Development, IT Support" }
        ];

        // Save data to localStorage function
        function saveData() {
            localStorage.setItem('projects', JSON.stringify(projects));
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('vendors', JSON.stringify(vendors));
        }

        // Mobile menu functionality
        document.getElementById('open-sidebar').addEventListener('click', function() {
            document.getElementById('sidebar').classList.remove('mobile-menu-closed');
            document.getElementById('sidebar').classList.add('mobile-menu-open');
            document.getElementById('mobile-overlay').classList.remove('hidden');
        });

        document.getElementById('close-sidebar').addEventListener('click', closeMobileMenu);
        document.getElementById('mobile-overlay').addEventListener('click', closeMobileMenu);

        function closeMobileMenu() {
            document.getElementById('sidebar').classList.remove('mobile-menu-open');
            document.getElementById('sidebar').classList.add('mobile-menu-closed');
            document.getElementById('mobile-overlay').classList.add('hidden');
        }

        // Section navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('text-white', 'bg-indigo-600');
                link.classList.add('text-gray-700', 'hover:bg-gray-100');
            });
            
            event.target.classList.remove('text-gray-700', 'hover:bg-gray-100');
            event.target.classList.add('text-white', 'bg-indigo-600');
            
            // Load section data
            if (sectionName === 'dashboard') {
                loadDashboard();
            } else if (sectionName === 'kanban') {
                loadKanban();
            } else if (sectionName === 'vendors') {
                loadVendors();
            }
            
            closeMobileMenu();
        }

        // Load dashboard data
        function loadDashboard() {
            // Load urgent tasks
            const urgentTasksContainer = document.getElementById('urgent-tasks');
            const urgentTasks = tasks.filter(task => task.priority === 'urgent' && task.due_date);
            
            if (urgentTasks.length === 0) {
                urgentTasksContainer.innerHTML = '<p class="text-sm text-gray-500">No urgent tasks</p>';
            } else {
                urgentTasksContainer.innerHTML = urgentTasks.map(task => `
                    <div class="flex items-center justify-between py-2">
                        <div>
                            <p class="text-sm font-medium text-gray-900">${task.title}</p>
                            <p class="text-xs text-gray-500">Due: ${formatDate(task.due_date)}</p>
                        </div>
                    </div>
                `).join('');
            }
            
            // Load recent projects
            const recentProjectsContainer = document.getElementById('recent-projects');
            recentProjectsContainer.innerHTML = projects.slice(0, 5).map(project => `
                <div class="flex items-center justify-between py-2">
                    <div class="cursor-pointer hover:text-indigo-600" onclick="showProjectDetail(${project.id})">
                        <p class="text-sm font-medium text-gray-900 hover:text-indigo-600">${project.title}</p>
                        <p class="text-xs text-gray-500">${project.tasks} tasks</p>
                    </div>
                </div>
            `).join('');
            
            // Update calendar widget
            updateCalendarWidget();
        }
        
        // Update calendar widget with current date
        function updateCalendarWidget() {
            const now = new Date();
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            const currentDate = now.getDate();
            const currentDay = days[now.getDay()];
            const currentMonth = months[now.getMonth()];
            const currentYear = now.getFullYear();
            
            document.getElementById('current-date').textContent = currentDate;
            document.getElementById('current-day').textContent = currentDay;
            document.getElementById('current-month-year').textContent = `${currentMonth} ${currentYear}`;
        }

        // Load kanban board
        function loadKanban() {
            const columns = {
                'todo': document.getElementById('todo-column'),
                'in_progress': document.getElementById('in-progress-column'),
                'review': document.getElementById('review-column'),
                'completed': document.getElementById('completed-column')
            };
            
            // Clear columns
            Object.values(columns).forEach(column => column.innerHTML = '');
            
            // Group tasks by status
            tasks.forEach(task => {
                const column = columns[task.status];
                if (column) {
                    const taskCard = document.createElement('div');
                    taskCard.className = 'group bg-white bg-opacity-90 backdrop-blur-sm p-4 rounded-xl shadow-card border border-white border-opacity-50 cursor-move hover-lift transition-all duration-300 hover:shadow-hover';
                    taskCard.draggable = true;
                    taskCard.dataset.taskId = task.id;
                    
                    // Get priority color
                    const priorityColors = {
                        'low': 'from-green-400 to-emerald-500',
                        'medium': 'from-yellow-400 to-orange-500', 
                        'high': 'from-orange-400 to-red-500',
                        'urgent': 'from-red-500 to-pink-600'
                    };
                    
                    const priorityColor = priorityColors[task.priority] || 'from-gray-400 to-gray-500';
                    
                    taskCard.innerHTML = `
                        <div class="flex items-start justify-between mb-3">
                            <div class="w-3 h-3 rounded-full bg-gradient-to-r ${priorityColor} shadow-sm"></div>
                            <div class="flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                <button onclick="editTask(${task.id})" class="p-1 rounded-lg hover:bg-blue-50 text-blue-600 transition-colors duration-200">
                                    <i data-lucide="edit-2" class="w-3 h-3"></i>
                                </button>
                                <button onclick="deleteTask(${task.id})" class="p-1 rounded-lg hover:bg-red-50 text-red-600 transition-colors duration-200">
                                    <i data-lucide="trash-2" class="w-3 h-3"></i>
                                </button>
                            </div>
                        </div>
                        <h4 class="font-semibold text-gray-900 text-sm mb-2 leading-tight">${task.title}</h4>
                        <p class="text-xs text-gray-600 mb-3 leading-relaxed">${task.description}</p>
                        ${task.due_date ? `
                            <div class="flex items-center text-xs text-gray-500 bg-gray-50 rounded-lg px-2 py-1">
                                <i data-lucide="calendar" class="w-3 h-3 mr-1"></i>
                                ${formatDate(task.due_date)}
                            </div>
                        ` : ''}
                    `;
                    
                    // Add drag event listeners
                    taskCard.addEventListener('dragstart', handleDragStart);
                    taskCard.addEventListener('dragend', handleDragEnd);
                    
                    // Add touch event listeners for mobile
                    taskCard.addEventListener('touchstart', handleTouchStart, { passive: false });
                    taskCard.addEventListener('touchmove', handleTouchMove, { passive: false });
                    taskCard.addEventListener('touchend', handleTouchEnd, { passive: false });
                    
                    column.appendChild(taskCard);
                }
            });
            
            // Add drop zone event listeners to columns
            Object.entries(columns).forEach(([status, column]) => {
                column.addEventListener('dragover', handleDragOver);
                column.addEventListener('drop', (e) => handleDrop(e, status));
                column.addEventListener('dragenter', handleDragEnter);
                column.addEventListener('dragleave', handleDragLeave);
            });
            
            // Re-initialize Lucide icons
            lucide.createIcons();
        }

        // Load vendors
        function loadVendors() {
            const vendorsContainer = document.getElementById('vendors-list');
            vendorsContainer.innerHTML = vendors.map(vendor => `
                <div class="group bg-white bg-opacity-80 backdrop-blur-sm overflow-hidden shadow-beautiful rounded-2xl hover-lift transition-all duration-300 border border-white border-opacity-50">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-xl font-bold text-gray-900">${vendor.name}</h3>
                            <div class="flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                <button onclick="editVendor(${vendor.id})" class="p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors duration-200">
                                    <i data-lucide="edit-2" class="w-4 h-4"></i>
                                </button>
                                <button onclick="deleteVendor(${vendor.id})" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors duration-200">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center text-sm text-gray-600">
                                <i data-lucide="user" class="w-4 h-4 mr-2 text-indigo-500"></i>
                                <span class="font-medium">${vendor.contact}</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i data-lucide="mail" class="w-4 h-4 mr-2 text-indigo-500"></i>
                                <a href="mailto:${vendor.email}" class="hover:text-indigo-600 transition-colors duration-200">${vendor.email}</a>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i data-lucide="phone" class="w-4 h-4 mr-2 text-indigo-500"></i>
                                <a href="tel:${vendor.phone}" class="hover:text-indigo-600 transition-colors duration-200">${vendor.phone}</a>
                            </div>
                            <div class="mt-4">
                                <p class="text-sm font-medium text-gray-700 mb-2">Services:</p>
                                <p class="text-sm text-gray-600 leading-relaxed">${vendor.services}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Re-initialize Lucide icons after updating vendor list
            lucide.createIcons();
        }

        // Load project list in sidebar
        function loadProjectList() {
            const projectListContainer = document.getElementById('project-list');
            projectListContainer.innerHTML = projects.map(project => `
                <a href="#" onclick="showProjectDetail(${project.id})" class="flex items-center justify-between px-3 py-2 text-sm text-gray-700 rounded-md hover:bg-gray-100">
                    <span class="truncate">${project.title}</span>
                    <span class="text-xs text-gray-500">${project.tasks}</span>
                </a>
            `).join('');
        }

        // Show project detail view
        function showProjectDetail(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show or create project detail section
            let projectDetailSection = document.getElementById('project-detail-section');
            if (!projectDetailSection) {
                projectDetailSection = document.createElement('div');
                projectDetailSection.id = 'project-detail-section';
                projectDetailSection.className = 'section px-4 sm:px-6 lg:px-8';
                document.querySelector('main').appendChild(projectDetailSection);
            }
            
            // Get project tasks
            const projectTasks = tasks.filter(task => task.project_id === projectId);
            
            // Check if this is Monthly Content project (ID 1)
            const isMonthlyContent = projectId === 1;
            
            // Populate project detail content
            projectDetailSection.innerHTML = `
                <div class="sm:flex sm:items-center sm:justify-between">
                    <div>
                        <button onclick="showSection('dashboard')" class="text-indigo-600 hover:text-indigo-500 text-sm font-medium mb-2 flex items-center">
                            <i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i>
                            Back to Dashboard
                        </button>
                        <div class="flex items-center space-x-3">
                            <div>
                                <h1 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">${project.title}</h1>
                                <p class="mt-1 text-sm text-gray-500">${project.description}</p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="editProject(${project.id})" class="text-gray-400 hover:text-indigo-600 p-1">
                                    <i data-lucide="edit-2" class="w-4 h-4"></i>
                                </button>
                                <button onclick="deleteProject(${project.id})" class="text-gray-400 hover:text-red-600 p-1">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 sm:ml-16 sm:mt-0 sm:flex-none">
                        <button onclick="showNewTaskForm(${project.id})" class="block rounded-md bg-indigo-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">
                            <i data-lucide="plus" class="w-4 h-4 inline mr-2"></i>
                            New Task
                        </button>
                    </div>
                </div>

                ${isMonthlyContent ? `
                    <div class="mt-6">
                        <div class="border-b border-gray-200">
                            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                                <button onclick="showMonthlyTab('all')" class="monthly-tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-month="all">
                                    All Tasks
                                </button>
                                <button onclick="showMonthlyTab('august')" class="monthly-tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-month="august">
                                    August
                                </button>
                                <button onclick="showMonthlyTab('september')" class="monthly-tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-month="september">
                                    September
                                </button>
                                <button onclick="showMonthlyTab('october')" class="monthly-tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-month="october">
                                    October
                                </button>
                                <button onclick="showMonthlyTab('november')" class="monthly-tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-month="november">
                                    November
                                </button>
                                <button onclick="showMonthlyTab('december')" class="monthly-tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-month="december">
                                    December
                                </button>
                                <button onclick="showMonthlyTab('january')" class="monthly-tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" data-month="january">
                                    January
                                </button>
                            </nav>
                        </div>
                    </div>
                ` : ''}

                <div class="mt-8">
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Project Tasks (<span id="task-count">${projectTasks.length}</span>)</h3>
                            
                            <div id="tasks-container">
                                ${projectTasks.length === 0 ? 
                                    '<p class="text-gray-500">No tasks yet. Create your first task to get started!</p>' :
                                    `<div class="space-y-3">
                                        ${projectTasks.map(task => `
                                            <div class="task-item border border-gray-200 rounded-lg p-4 hover:bg-gray-50" data-month="${getTaskMonth(task)}">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex-1">
                                                        <h4 class="text-sm font-medium text-gray-900">${task.title}</h4>
                                                        <p class="text-sm text-gray-500 mt-1">${task.description}</p>
                                                        <div class="flex items-center mt-2 space-x-4">
                                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusBadgeClass(task.status)}">
                                                                ${task.status.replace('_', ' ').toUpperCase()}
                                                            </span>
                                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getPriorityBadgeClass(task.priority)}">
                                                                ${task.priority.toUpperCase()}
                                                            </span>
                                                            ${task.due_date ? `<span class="text-xs text-gray-500">Due: ${formatDate(task.due_date)}</span>` : ''}
                                                        </div>
                                                    </div>
                                                    <div class="flex space-x-2 ml-4">
                                                        <button onclick="editTask(${task.id})" class="text-gray-400 hover:text-indigo-600 p-1">
                                                            <i data-lucide="edit-2" class="w-4 h-4"></i>
                                                        </button>
                                                        <button onclick="deleteTask(${task.id})" class="text-gray-400 hover:text-red-600 p-1">
                                                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                </div>`
                            }
                        </div>
                    </div>
                </div>
            `;
            
            projectDetailSection.classList.remove('hidden');
            
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('text-white', 'bg-indigo-600');
                link.classList.add('text-gray-700', 'hover:bg-gray-100');
            });
            
            // Re-initialize icons
            lucide.createIcons();
            
            closeMobileMenu();
        }

        // Helper functions for badge classes
        function getStatusBadgeClass(status) {
            switch(status) {
                case 'todo': return 'bg-gray-100 text-gray-800';
                case 'in_progress': return 'bg-blue-100 text-blue-800';
                case 'review': return 'bg-yellow-100 text-yellow-800';
                case 'completed': return 'bg-green-100 text-green-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getPriorityBadgeClass(priority) {
            switch(priority) {
                case 'low': return 'bg-green-100 text-green-800';
                case 'medium': return 'bg-yellow-100 text-yellow-800';
                case 'high': return 'bg-orange-100 text-orange-800';
                case 'urgent': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // New project form
        function showNewProjectForm() {
            document.getElementById('new-project-modal').classList.remove('hidden');
        }

        function hideNewProjectForm() {
            document.getElementById('new-project-modal').classList.add('hidden');
            document.getElementById('new-project-form').reset();
        }

        function showNewTaskForm(projectId) {
            document.getElementById('task-project-id').value = projectId;
            document.getElementById('new-task-modal').classList.remove('hidden');
        }

        function hideNewTaskForm() {
            document.getElementById('new-task-modal').classList.add('hidden');
            document.getElementById('new-task-form').reset();
        }

        // Edit Project Functions
        function editProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            
            document.getElementById('edit-project-id').value = project.id;
            document.getElementById('edit-project-title').value = project.title;
            document.getElementById('edit-project-description').value = project.description;
            document.getElementById('edit-project-priority').value = project.priority;
            document.getElementById('edit-project-modal').classList.remove('hidden');
        }

        function hideEditProjectForm() {
            document.getElementById('edit-project-modal').classList.add('hidden');
            document.getElementById('edit-project-form').reset();
        }

        // Delete Project Function
        function deleteProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            
            if (confirm(`Are you sure you want to delete "${project.title}"? This will also delete all associated tasks.`)) {
                // Remove project
                const projectIndex = projects.findIndex(p => p.id === projectId);
                projects.splice(projectIndex, 1);
                
                // Remove associated tasks
                tasks = tasks.filter(task => task.project_id !== projectId);
                saveData(); // Save to localStorage
                
                // Refresh UI and go back to dashboard
                loadProjectList();
                loadDashboard();
                showSection('dashboard');
                
                alert('Project deleted successfully!');
            }
        }

        // Edit Task Functions
        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            document.getElementById('edit-task-id').value = task.id;
            document.getElementById('edit-task-title').value = task.title;
            document.getElementById('edit-task-description').value = task.description;
            document.getElementById('edit-task-status').value = task.status;
            document.getElementById('edit-task-priority').value = task.priority;
            document.getElementById('edit-task-due-date').value = task.due_date || '';
            document.getElementById('edit-task-modal').classList.remove('hidden');
        }

        function hideEditTaskForm() {
            document.getElementById('edit-task-modal').classList.add('hidden');
            document.getElementById('edit-task-form').reset();
        }

        // Delete Task Function
        function deleteTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            if (confirm(`Are you sure you want to delete "${task.title}"?`)) {
                const taskIndex = tasks.findIndex(t => t.id === taskId);
                tasks.splice(taskIndex, 1);
                saveData(); // Save to localStorage
                
                // Update project task count
                const project = projects.find(p => p.id === task.project_id);
                if (project) {
                    project.tasks = Math.max(0, project.tasks - 1);
                }
                
                // Refresh current view
                showProjectDetail(task.project_id);
                loadProjectList();
                
                alert('Task deleted successfully!');
            }
        }

        // Handle new project form submission
        document.getElementById('new-project-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('project-title').value;
            const description = document.getElementById('project-description').value;
            const priority = document.getElementById('project-priority').value;
            
            // Add new project to the list
            const newProject = {
                id: projects.length + 1,
                title: title,
                description: description,
                status: 'active',
                priority: priority,
                tasks: 0
            };
            
            projects.push(newProject);
            saveData(); // Save to localStorage
            
            // Refresh the UI
            loadProjectList();
            loadDashboard();
            
            // Hide the modal
            hideNewProjectForm();
            
            // Show success message
            alert('Project created successfully!');
        });

        // Handle edit project form submission
        document.getElementById('edit-project-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const projectId = parseInt(document.getElementById('edit-project-id').value);
            const title = document.getElementById('edit-project-title').value;
            const description = document.getElementById('edit-project-description').value;
            const priority = document.getElementById('edit-project-priority').value;
            
            // Update project in the list
            const project = projects.find(p => p.id === projectId);
            if (project) {
                project.title = title;
                project.description = description;
                project.priority = priority;
            }
            
            // Refresh the UI
            loadProjectList();
            loadDashboard();
            showProjectDetail(projectId);
            
            // Hide the modal
            hideEditProjectForm();
            
            // Show success message
            alert('Project updated successfully!');
        });

        // Handle new task form submission
        document.getElementById('new-task-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const projectId = parseInt(document.getElementById('task-project-id').value);
            const title = document.getElementById('task-title').value;
            const description = document.getElementById('task-description').value;
            const status = document.getElementById('task-status').value;
            const priority = document.getElementById('task-priority').value;
            const dueDate = document.getElementById('task-due-date').value;
            
            // Add new task to the list
            const newTask = {
                id: tasks.length + 1,
                title: title,
                description: description,
                status: status,
                priority: priority,
                due_date: dueDate || null,
                project_id: projectId
            };
            
            tasks.push(newTask);
            saveData(); // Save to localStorage
            
            // Update project task count
            const project = projects.find(p => p.id === projectId);
            if (project) {
                project.tasks += 1;
            }
            
            // Refresh the UI
            showProjectDetail(projectId);
            loadProjectList();
            loadDashboard();
            
            // Hide the modal
            hideNewTaskForm();
            
            // Show success message
            alert('Task created successfully!');
        });

        // Handle edit task form submission
        document.getElementById('edit-task-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const taskId = parseInt(document.getElementById('edit-task-id').value);
            const title = document.getElementById('edit-task-title').value;
            const description = document.getElementById('edit-task-description').value;
            const status = document.getElementById('edit-task-status').value;
            const priority = document.getElementById('edit-task-priority').value;
            const dueDate = document.getElementById('edit-task-due-date').value;
            
            // Update task in the list
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.title = title;
                task.description = description;
                task.status = status;
                task.priority = priority;
                task.due_date = dueDate || null;
            }
            saveData(); // Save to localStorage
            
            // Refresh the UI
            showProjectDetail(task.project_id);
            loadDashboard();
            loadKanban();
            
            // Hide the modal
            hideEditTaskForm();
            
            // Show success message
            alert('Task updated successfully!');
        });

        // Utility functions
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }

        // Monthly Content tab functionality
        function showMonthlyTab(month) {
            // Update tab styling
            document.querySelectorAll('.monthly-tab-btn').forEach(btn => {
                btn.classList.remove('border-indigo-500', 'text-indigo-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            const activeTab = document.querySelector(`[data-month="${month}"]`);
            if (activeTab) {
                activeTab.classList.remove('border-transparent', 'text-gray-500');
                activeTab.classList.add('border-indigo-500', 'text-indigo-600');
            }
            
            // Filter tasks
            const taskItems = document.querySelectorAll('.task-item');
            let visibleCount = 0;
            
            taskItems.forEach(item => {
                const taskMonth = item.getAttribute('data-month');
                if (month === 'all' || taskMonth === month) {
                    item.style.display = 'block';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Update task count
            const taskCountElement = document.getElementById('task-count');
            if (taskCountElement) {
                taskCountElement.textContent = visibleCount;
            }
        }

        // Helper function to get task month from due date or title
        function getTaskMonth(task) {
            // First check if due date exists and extract month
            if (task.due_date) {
                const date = new Date(task.due_date);
                const month = date.getMonth();
                const monthNames = ['january', 'february', 'march', 'april', 'may', 'june', 
                                  'july', 'august', 'september', 'october', 'november', 'december'];
                return monthNames[month];
            }
            
            // If no due date, try to extract from title or description
            const text = (task.title + ' ' + task.description).toLowerCase();
            const months = ['august', 'september', 'october', 'november', 'december', 'january'];
            
            for (const month of months) {
                if (text.includes(month)) {
                    return month;
                }
            }
            
            // Default to 'other' if no month found
            return 'other';
        }

        // Drag and Drop functionality
        let draggedElement = null;
        let touchStartPos = { x: 0, y: 0 };
        let isDragging = false;

        function handleDragStart(e) {
            draggedElement = e.target;
            e.target.style.opacity = '0.5';
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
        }

        function handleDragEnd(e) {
            e.target.style.opacity = '';
            draggedElement = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            e.preventDefault();
            e.target.classList.add('bg-gray-100');
        }

        function handleDragLeave(e) {
            e.target.classList.remove('bg-gray-100');
        }

        function handleDrop(e, newStatus) {
            e.preventDefault();
            e.target.classList.remove('bg-gray-100');
            
            if (draggedElement) {
                const taskId = parseInt(draggedElement.dataset.taskId);
                const task = tasks.find(t => t.id === taskId);
                
                if (task && task.status !== newStatus) {
                    // Update task status
                    task.status = newStatus;
                    saveData(); // Save to localStorage
                    
                    // Reload kanban board
                    loadKanban();
                    
                    // Update other views
                    loadDashboard();
                    
                    // Show success message
                    console.log(`Task "${task.title}" moved to ${newStatus.replace('_', ' ').toUpperCase()}`);
                }
            }
        }

        // Touch events for mobile drag and drop
        function handleTouchStart(e) {
            const touch = e.touches[0];
            touchStartPos = { x: touch.clientX, y: touch.clientY };
            draggedElement = e.currentTarget; // Use currentTarget instead of target
            isDragging = false;
            
            // Add visual feedback immediately
            draggedElement.style.transition = 'transform 0.1s ease';
        }

        function handleTouchMove(e) {
            if (!draggedElement) return;
            
            e.preventDefault(); // Prevent scrolling
            const touch = e.touches[0];
            const deltaX = touch.clientX - touchStartPos.x;
            const deltaY = touch.clientY - touchStartPos.y;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            
            // Start dragging if moved more than 5px
            if (distance > 5) {
                isDragging = true;
                draggedElement.style.opacity = '0.7';
                draggedElement.style.transform = `translate(${deltaX}px, ${deltaY}px) scale(1.05)`;
                draggedElement.style.zIndex = '1000';
                draggedElement.style.pointerEvents = 'none';
                
                // Add visual feedback to columns
                const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                const columns = document.querySelectorAll('[id$="-column"]');
                columns.forEach(col => col.classList.remove('bg-blue-50', 'border-blue-300'));
                
                if (elementBelow) {
                    let targetColumn = elementBelow;
                    while (targetColumn && !targetColumn.id.includes('-column')) {
                        targetColumn = targetColumn.parentElement;
                    }
                    if (targetColumn) {
                        targetColumn.classList.add('bg-blue-50', 'border-blue-300');
                    }
                }
            }
        }

        function handleTouchEnd(e) {
            if (!draggedElement) return;
            
            // Remove visual feedback from all columns
            const columns = document.querySelectorAll('[id$="-column"]');
            columns.forEach(col => col.classList.remove('bg-blue-50', 'border-blue-300'));
            
            if (!isDragging) {
                // Reset styles and exit if not dragging
                draggedElement.style.opacity = '';
                draggedElement.style.transform = '';
                draggedElement.style.zIndex = '';
                draggedElement.style.pointerEvents = '';
                draggedElement.style.transition = '';
                draggedElement = null;
                return;
            }
            
            const touch = e.changedTouches[0];
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            
            // Find the target column
            let targetColumn = elementBelow;
            while (targetColumn && !targetColumn.id.includes('-column')) {
                targetColumn = targetColumn.parentElement;
            }
            
            if (targetColumn) {
                const newStatus = targetColumn.id.replace('-column', '').replace('-', '_');
                const taskId = parseInt(draggedElement.dataset.taskId);
                const task = tasks.find(t => t.id === taskId);
                
                if (task && task.status !== newStatus) {
                    // Update task status
                    task.status = newStatus;
                    saveData(); // Save to localStorage
                    
                    // Show success feedback
                    targetColumn.style.backgroundColor = '#dcfce7'; // Light green
                    setTimeout(() => {
                        targetColumn.style.backgroundColor = '';
                    }, 300);
                    
                    // Reload kanban board
                    loadKanban();
                    
                    // Update other views
                    loadDashboard();
                    
                    // Show success message
                    console.log(`Task "${task.title}" moved to ${newStatus.replace('_', ' ').toUpperCase()}`);
                } else {
                    // Animate back to original position if no valid drop
                    draggedElement.style.transform = '';
                    setTimeout(() => {
                        draggedElement.style.opacity = '';
                        draggedElement.style.zIndex = '';
                        draggedElement.style.pointerEvents = '';
                        draggedElement.style.transition = '';
                    }, 200);
                }
            } else {
                // Animate back to original position
                draggedElement.style.transform = '';
                setTimeout(() => {
                    draggedElement.style.opacity = '';
                    draggedElement.style.zIndex = '';
                    draggedElement.style.pointerEvents = '';
                    draggedElement.style.transition = '';
                }, 200);
            }
            
            // Reset variables
            draggedElement = null;
            isDragging = false;
        }
        
        // Vendor management functions
        function showNewVendorForm() {
            document.getElementById('new-vendor-modal').classList.remove('hidden');
        }
        
        function hideNewVendorForm() {
            document.getElementById('new-vendor-modal').classList.add('hidden');
            document.getElementById('new-vendor-form').reset();
        }
        
        function editVendor(vendorId) {
            const vendor = vendors.find(v => v.id === vendorId);
            if (vendor) {
                document.getElementById('edit-vendor-id').value = vendor.id;
                document.getElementById('edit-vendor-name').value = vendor.name;
                document.getElementById('edit-vendor-contact').value = vendor.contact;
                document.getElementById('edit-vendor-email').value = vendor.email;
                document.getElementById('edit-vendor-phone').value = vendor.phone;
                document.getElementById('edit-vendor-services').value = vendor.services;
                document.getElementById('edit-vendor-modal').classList.remove('hidden');
            }
        }
        
        function hideEditVendorForm() {
            document.getElementById('edit-vendor-modal').classList.add('hidden');
            document.getElementById('edit-vendor-form').reset();
        }
        
        function deleteVendor(vendorId) {
            if (confirm('Are you sure you want to delete this vendor?')) {
                const index = vendors.findIndex(v => v.id === vendorId);
                if (index !== -1) {
                    vendors.splice(index, 1);
                    saveData(); // Save to localStorage
                    loadVendors();
                    // Re-initialize Lucide icons
                    lucide.createIcons();
                }
            }
        }
        
        // Search functionality
        function performSearch(searchTerm) {
            if (!searchTerm) {
                // If search is empty, show dashboard
                showSection('dashboard');
                return;
            }
            
            // Search through projects and tasks
            const searchResults = [];
            
            // Search projects
            projects.forEach(project => {
                if (project.title.toLowerCase().includes(searchTerm) || 
                    project.description.toLowerCase().includes(searchTerm)) {
                    searchResults.push({
                        type: 'project',
                        id: project.id,
                        title: project.title,
                        description: project.description,
                        match: 'Project'
                    });
                }
            });
            
            // Search tasks
            tasks.forEach(task => {
                if (task.title.toLowerCase().includes(searchTerm) || 
                    task.description.toLowerCase().includes(searchTerm)) {
                    const project = projects.find(p => p.id === task.projectId);
                    searchResults.push({
                        type: 'task',
                        id: task.id,
                        projectId: task.projectId,
                        title: task.title,
                        description: task.description,
                        project: project ? project.title : 'Unknown Project',
                        match: 'Task'
                    });
                }
            });
            
            // Search vendors
            vendors.forEach(vendor => {
                if (vendor.name.toLowerCase().includes(searchTerm) || 
                    vendor.contact.toLowerCase().includes(searchTerm) ||
                    vendor.services.toLowerCase().includes(searchTerm)) {
                    searchResults.push({
                        type: 'vendor',
                        id: vendor.id,
                        title: vendor.name,
                        description: vendor.services,
                        contact: vendor.contact,
                        match: 'Vendor'
                    });
                }
            });
            
            // Display search results
            displaySearchResults(searchResults, searchTerm);
        }
        
        function displaySearchResults(results, searchTerm) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show search results section
            let searchSection = document.getElementById('search-results-section');
            if (!searchSection) {
                // Create search results section if it doesn't exist
                searchSection = document.createElement('div');
                searchSection.id = 'search-results-section';
                searchSection.className = 'section px-4 sm:px-6 lg:px-8';
                document.querySelector('main').appendChild(searchSection);
            }
            
            searchSection.classList.remove('hidden');
            
            // Generate search results HTML
            const resultsHTML = `
                <div class="sm:flex sm:items-center sm:justify-between mb-8">
                    <div class="animate-slide-up">
                        <h1 class="text-4xl font-bold leading-7 bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent sm:truncate sm:text-5xl sm:tracking-tight">Search Results</h1>
                        <p class="mt-2 text-lg text-gray-600">Found ${results.length} result(s) for "${searchTerm}" 🔍</p>
                    </div>
                    <div class="mt-6 sm:ml-16 sm:mt-0 sm:flex-none animate-slide-up">
                        <button onclick="showSection('dashboard')" class="group relative overflow-hidden rounded-2xl bg-gray-600 px-6 py-3 text-center text-sm font-semibold text-white shadow-beautiful hover-lift transition-all duration-300">
                            <div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                            <span class="relative flex items-center">
                                <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                                Back to Dashboard
                            </span>
                        </button>
                    </div>
                </div>
                
                <div class="grid gap-6">
                    ${results.length === 0 ? `
                        <div class="text-center py-12">
                            <i data-lucide="search-x" class="w-16 h-16 text-gray-400 mx-auto mb-4"></i>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">No results found</h3>
                            <p class="text-gray-500">Try searching with different keywords</p>
                        </div>
                    ` : results.map(result => `
                        <div class="bg-white rounded-2xl shadow-card hover:shadow-hover transition-all duration-200 p-6 animate-fade-in">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                            result.type === 'project' ? 'bg-blue-100 text-blue-800' :
                                            result.type === 'task' ? 'bg-green-100 text-green-800' :
                                            'bg-purple-100 text-purple-800'
                                        }">
                                            ${result.match}
                                        </span>
                                        ${result.project ? `<span class="ml-2 text-sm text-gray-500">in ${result.project}</span>` : ''}
                                    </div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-2">${result.title}</h3>
                                    <p class="text-gray-600 mb-3">${result.description}</p>
                                    ${result.contact ? `<p class="text-sm text-gray-500">Contact: ${result.contact}</p>` : ''}
                                </div>
                                <div class="ml-4">
                                    ${result.type === 'project' ? `
                                        <button onclick="showProjectDetail(${result.id})" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 transition-colors duration-200">
                                            View Project
                                        </button>
                                    ` : result.type === 'task' ? `
                                        <button onclick="showProjectDetail(${result.projectId})" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-green-700 bg-green-100 hover:bg-green-200 transition-colors duration-200">
                                            View Task
                                        </button>
                                    ` : `
                                        <button onclick="showSection('vendors')" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-purple-700 bg-purple-100 hover:bg-purple-200 transition-colors duration-200">
                                            View Vendor
                                        </button>
                                    `}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            searchSection.innerHTML = resultsHTML;
            
            // Re-initialize Lucide icons
            lucide.createIcons();
        }
        
        // AI Assistant functionality
        let openaiApiKey = localStorage.getItem('openai-api-key') || '';
        
        function saveApiKey() {
            const apiKey = document.getElementById('openai-api-key').value.trim();
            if (apiKey) {
                openaiApiKey = apiKey;
                localStorage.setItem('openai-api-key', apiKey);
                document.getElementById('openai-api-key').value = '';
                addAIMessage('API key saved successfully! You can now ask me questions about your projects.', 'assistant');
                document.getElementById('api-key-setup').style.display = 'none';
            }
        }
        
        function resetApiKey() {
            openaiApiKey = '';
            localStorage.removeItem('openai-api-key');
            document.getElementById('openai-api-key').value = '';
            document.getElementById('api-key-setup').style.display = 'block';
            addAIMessage('API key has been reset. Please enter your correct OpenAI API key.', 'assistant');
        }
        
        function clearAIChat() {
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0 w-8 h-8 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full flex items-center justify-center">
                        <i data-lucide="bot" class="w-4 h-4 text-white"></i>
                    </div>
                    <div class="flex-1 bg-white rounded-2xl p-4 shadow-sm">
                        <p class="text-gray-700">Hi! I'm your AI assistant. I can help you with questions about your projects, tasks, and vendors.</p>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }
        
        function addAIMessage(message, sender) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start space-x-3';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="flex-shrink-0 w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center">
                        <i data-lucide="user" class="w-4 h-4 text-white"></i>
                    </div>
                    <div class="flex-1 bg-blue-50 rounded-2xl p-4 shadow-sm">
                        <p class="text-gray-800">${message}</p>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="flex-shrink-0 w-8 h-8 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full flex items-center justify-center">
                        <i data-lucide="bot" class="w-4 h-4 text-white"></i>
                    </div>
                    <div class="flex-1 bg-white rounded-2xl p-4 shadow-sm">
                        <p class="text-gray-700">${message}</p>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            lucide.createIcons();
        }
        
        async function sendAIMessage() {
            const input = document.getElementById('ai-chat-input');
            const message = input.value.trim();
            const sendButton = document.getElementById('send-ai-message');
            
            if (!message) return;
            
            if (!openaiApiKey) {
                addAIMessage('Please enter your OpenAI API key first to use the AI assistant.', 'assistant');
                document.getElementById('api-key-setup').style.display = 'block';
                return;
            }
            
            // Add user message
            addAIMessage(message, 'user');
            input.value = '';
            
            // Disable send button
            sendButton.disabled = true;
            sendButton.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>';
            
            try {
                // Prepare context data
                const contextData = {
                    projects: projects,
                    tasks: tasks,
                    vendors: vendors
                };
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${openaiApiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: `You are a helpful AI assistant for a project management system. You have access to the user's project data including projects, tasks, and vendors. 
                                
                                Current data:
                                Projects: ${JSON.stringify(contextData.projects, null, 2)}
                                Tasks: ${JSON.stringify(contextData.tasks, null, 2)}
                                Vendors: ${JSON.stringify(contextData.vendors, null, 2)}
                                
                                Please provide helpful, specific answers based on this data. Be conversational and friendly. When referencing specific items, use their actual names and details from the data.`
                            },
                            {
                                role: 'user',
                                content: message
                            }
                        ],
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('API Error:', response.status, errorData);
                    throw new Error(`API request failed: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
                }
                
                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                addAIMessage(aiResponse, 'assistant');
                
            } catch (error) {
                console.error('AI request error:', error);
                let errorMessage = 'Sorry, I encountered an error processing your request.';
                
                if (error.message.includes('401')) {
                    errorMessage = 'Invalid API key. Please check your OpenAI API key and try again.';
                } else if (error.message.includes('429')) {
                    errorMessage = 'Rate limit exceeded. Please wait a moment and try again.';
                } else if (error.message.includes('403')) {
                    errorMessage = 'Access denied. Please check your API key permissions.';
                } else if (error.message.includes('network') || error.message.includes('fetch')) {
                    errorMessage = 'Network error. Please check your internet connection and try again.';
                }
                
                addAIMessage(errorMessage, 'assistant');
            }
            
            // Re-enable send button
            sendButton.disabled = false;
            sendButton.innerHTML = '<i data-lucide="send" class="w-4 h-4"></i>';
            lucide.createIcons();
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Load API key from localStorage
            const savedApiKey = localStorage.getItem('openai-api-key');
            if (savedApiKey) {
                openaiApiKey = savedApiKey;
                document.getElementById('api-key-setup').style.display = 'none';
            }
            
            lucide.createIcons();
            loadProjectList();
            loadDashboard();
            
            // Initialize search functionality
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase().trim();
                performSearch(searchTerm);
            });
            
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const searchTerm = e.target.value.toLowerCase().trim();
                    performSearch(searchTerm);
                }
            });
            
            // Add vendor form event listeners
            document.getElementById('new-vendor-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('new-vendor-name').value;
                const contact = document.getElementById('new-vendor-contact').value;
                const email = document.getElementById('new-vendor-email').value;
                const phone = document.getElementById('new-vendor-phone').value;
                const services = document.getElementById('new-vendor-services').value;
                
                // Add new vendor to the list
                const newVendor = {
                    id: vendors.length + 1,
                    name: name,
                    contact: contact,
                    email: email,
                    phone: phone,
                    services: services
                };
                
                vendors.push(newVendor);
                saveData(); // Save to localStorage
                loadVendors();
                hideNewVendorForm();
                
                // Re-initialize Lucide icons
                lucide.createIcons();
            });
            
            document.getElementById('edit-vendor-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const vendorId = parseInt(document.getElementById('edit-vendor-id').value);
                const name = document.getElementById('edit-vendor-name').value;
                const contact = document.getElementById('edit-vendor-contact').value;
                const email = document.getElementById('edit-vendor-email').value;
                const phone = document.getElementById('edit-vendor-phone').value;
                const services = document.getElementById('edit-vendor-services').value;
                
                // Update vendor in the list
                const vendorIndex = vendors.findIndex(v => v.id === vendorId);
                if (vendorIndex !== -1) {
                    vendors[vendorIndex] = {
                        id: vendorId,
                        name: name,
                        contact: contact,
                        email: email,
                        phone: phone,
                        services: services
                    };
                    saveData(); // Save to localStorage
                    
                    loadVendors();
                    hideEditVendorForm();
                    
                    // Re-initialize Lucide icons
                    lucide.createIcons();
                }
            });
        });;
    </script>
</body>
</html>
